<?php
include ('../config.inc.php');
include ('../../ssi_smart/smart_form/include_form.php');

// $arr ['form'] = array ('action' => "ajax/form_edit2.php",'id' => 'form_home','class'=>'center' );
// $arr ['ajax'] = array ('success' => "$('#message').toast({ class: 'red ', title: 'Trade is stoppt!', 'position':'top center' });",'dataType' => "html" );
// //$arr ['hidden'] ['list_id'] = 'form_home';
// $output = call_form ( $arr );
// echo $output ['html'];
// echo $output ['js'];
$arr ['form'] = array ('action' => "ajax/form_edit2.php",'id' => 'form_home','class'=>'huge', 'width' => '1000' );
$arr ['field'] [] = array ('type' => 'div','class' => 'two fields' );
$arr ['field']['stop_trade'] = array ('type' => 'button','text' => ' Start Trading', 'icon'=>'play','class' => 'green circular fluid','js' => "stop_trade()" );
$arr ['field']['start_trade'] = array ('type' => 'button','text' => ' Stop Trading', 'icon' => 'stop','class' => 'blue circular fluid ','js' => "start_trade()" );
$arr ['field']['stop_server'] = array ('type' => 'button','text' => ' Stop Server', 'icon' => 'server','class' => 'red circular fluid','js' => "stop_server()" );
$arr ['field'] [] = array ('type' => 'div_close' );

$output = call_form ( $arr );
 echo $output ['html'];
echo "<br>";

$arr ['form'] = array ('action' => "ajax/form_edit2.php",'id' => 'form_setting','class'=>'center segment' );
$arr ['sql'] = array ('query' => "SELECT * from ssi_trader.setting WHERE setting_id  = '1'" );
$arr ['ajax'] = array ('success' => "submit_hedging(data)",'dataType' => "html" );
$arr ['field'] ['title'] = array ('type' => 'input','label' => 'Title','focus' => true );
//$arr ['field'] ['text'] = array ('type' => 'textarea','label' => 'Description' );
$arr ['field']['strategy_id'] = array('type'=>'dropdown','label'=>'Hedging Strategy','array_mysql'=>'SELECT group_id, title FROM ssi_trader.hedging_group ORDER BY title ASC','text'=>'title','class'=>'fluid search selection');
$arr ['hidden'] ['list_id'] = 'form_setting';
$arr ['button'] ['submit'] = array ('value' => "Execute",'color' => 'blue');
$output = call_form ( $arr );
$execute_form =  $output ['html'].$output ['js'];

$connection = mysqli_connect($cfg_mysql['server'], $cfg_mysql['user'], $cfg_mysql['password'], $cfg_mysql['db']);

// Fetch data from the database and display using smart_list
$query = "SELECT * FROM ssi_trader.stocks_data ORDER BY time DESC LIMIT 200";
$result = mysqli_query($connection, $query);

if ($result) {
    $rows = mysqli_fetch_all($result, MYSQLI_ASSOC);
    $smart_list = "<table class='ui very compact basic celled table'>";
    $smart_list .= "<thead><tr><th>Buy</th><th>Sell</th><th>Time</th><th>Price</th></tr></thead> <tbody>";
    foreach ($rows as $row) {
        
        $smart_list .= "<tr><td" . ($row['buy'] > $row['sell'] ? " class='red'" : "") . ">" . $row['buy'] . "</td><td" . ($row['sell'] > $row['buy'] ? " class='red'" : "") . ">" . $row['sell'] . "</td><td>" . $row['time'] . "</td><td>" . $row['price'] . "</td></tr>";
    }
    $smart_list .= " <tbody></table>";
} else {
    $smart_list = "Fehler beim Abrufen der Daten aus der Datenbank.";
}


?>
<style>
.scrollable-segment {
    max-height: 600px;
    overflow-y: auto;
}
</style>
<div class="ui grid" style='width: 1030px'>
<div class="five wide column"><?=$execute_form?></div>
<div class="eleven wide column"><div class='ui segment scrollable-segment'><?=$smart_list?></div></div>
</div>

<script type='text/javascript' src='js/form_home.js'></script>