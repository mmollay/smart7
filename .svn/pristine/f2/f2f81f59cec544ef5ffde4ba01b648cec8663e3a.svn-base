<?
include(__DIR__ . "/../config.inc.php");
include('../../ssi_smart/smart_form/include_form.php');

$defaul_value['lot'] = '1';

//Start -  Trade
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_buy_sell', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['field'][] = array('type' => 'div', 'class' => 'two fields');
$arr['field']['buy_sell'] = array('type' => 'dropdown', 'label' => 'Trade', 'array' => array('buy' => 'Buy', 'sell' => 'Sell'), 'class' => 'fluid search selection', 'validate' => true, 'value' => 'buy');
$arr['field']['qty'] = array('type' => 'input', 'label' => 'Lots', 'focus' => true, 'value' => $defaul_value['lot'], 'validate' => true, 'wide' => 'three');

$arr['field'][] = array('type' => 'div_close');
$arr['button']['submit'] = array('value' => 'Market Order', 'icon' => 'play', 'class' => 'green circular fluid');
$output = call_form($arr);
$field_buysell_start = $output['html'] . $output['js'];

//Stop - Trade
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_buy_sell_stop', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['field'][] = array('type' => 'div', 'class' => 'fields');
$arr['field']['buy_sell_stop'] = array('type' => 'dropdown', 'label' => 'Trade', 'array' => array('buyStop' => 'Stop Buy', 'sellStop' => 'Stop Sell'), 'class' => 'fluid search selection', 'validate' => true);
$arr['field']['qty'] = array('type' => 'input', 'label' => 'Lots', 'focus' => true, 'value' => $defaul_value['lot'], 'validate' => true, 'wide' => 'four');
$arr['field']['price'] = array('type' => 'input', 'label' => 'Price', 'focus' => true, 'validate' => true, 'wide' => 'six');
$arr['field'][] = array('type' => 'div_close');
$arr['button']['submit'] = array('value' => 'Stop Orders', 'icon' => 'counterclockwise rotated step backward', 'class' => 'blue');
$output = call_form($arr);
$field_buysell_stop = $output['html'] . $output['js'];

//Limit - Trade
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_buy_sell_limit', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['field'][] = array('type' => 'div', 'class' => 'fields');
$arr['field']['buy_sell_limit'] = array('type' => 'dropdown', 'label' => 'Trade', 'array' => array('buyLimit' => 'Limit Buy', 'sellLimit' => 'Limit Sell'), 'class' => 'fluid search selection', 'validate' => true);
$arr['field']['qty'] = array('type' => 'input', 'label' => 'Lots', 'focus' => true, 'value' => $defaul_value['lot'], 'validate' => true, 'wide' => 'four');
$arr['field']['price'] = array('type' => 'input', 'label' => 'Price', 'focus' => true, 'validate' => true, 'wide' => 'six');
$arr['field'][] = array('type' => 'div_close');
$arr['button']['submit'] = array('value' => 'Limit Orders', 'icon' => 'clockwise rotated step backward', 'class' => 'blue');
$output = call_form($arr);
$field_buysell_limit = $output['html'] . $output['js'];

$sql_broker_server =
    'SELECT broker_id, CONCAT(broker_server, "<br>", name) as title
    FROM ssi_trader.broker a LEFT JOIN ssi_trader.server b ON a.server_id = b.server_id  
        WHERE a.user_id = ' . $_SESSION['user_id'] . ' 
            ORDER BY broker_server ASC
            ';

//change Settings  - Form
$arr['form'] = array('action' => "ajax/form_edit2.php", 'id' => 'form_choose_strategy', 'class' => 'message');
$arr['sql'] = array('query' => "SELECT * from ssi_trader.setting WHERE user_id = " . $_SESSION['user_id']);
$arr['ajax'] = array('success' => "submit_hedging(data)", 'dataType' => "html");
$arr['field']['broker_id'] = array('type' => 'dropdown', 'label' => 'Broker - Server', 'array_mysql' => $sql_broker_server, 'text' => 'title', 'class' => 'fluid search selection');
$arr['field']['strategy_id'] = array('label' => 'Hegding-Strategy', 'type' => 'dropdown', 'array_mysql' => 'SELECT group_id, title FROM ssi_trader.hedging_group ORDER BY title ASC', 'text' => 'title', 'class' => 'fluid search selection');
$arr['hidden']['list_id'] = 'form_setting1';
$arr['button']['submit'] = array('value' => "Choose ", 'color' => 'blue');
$output = call_form($arr);
$field_hedingstrategy_id = $output['html'] . $output['js'] . "<br>";

?>
<style>
    .scrollable-segment {
        max-height: 600px;
        overflow-y: auto;
    }
</style>

<div style='max-width: 1100px; text-align:left;'>
    <div class="ui grid">
        <div class="eight wide column">
            <?= $field_stratety ?>
        </div>
        <div class="eight wide column">
            <?= $field_buysell_start ?><br>
            <?= $field_buysell_stop ?><br>
            <?= $field_buysell_limit ?>
            <br>
            <?= $field_hedingstrategy_id ?>
            <?= $field_hedingstrategy_account ?>
            <?= $field_killall ?>
        </div>
    </div>

    <!-- <div class="ui grid">
        <div class="five wide column"><?= $field_hedingstrategy_id ?><?= $field_hedingstrategy_account ?><?= $field_killall ?></div>
        <div class="eleven wide column">
            <div class='ui segment scrollable-segment'><?= $smart_list ?></div>
        </div>
    </div> -->
    <br>

</div>


<script type='text/javascript' src='js/form_develop.js'></script>

<?php
//http://85.215.176.20:5000/buyLimit "qty":0.1, "price":16500.0, "takeProfitPrice":17000.0, "stopLossPrice":16000.0
//http://85.215.176.20:5000/buyMarket "qty":0.1
//http://85.215.176.20:5000/sellMarket "qty":0.1
//http://85.215.176.20:5000/cancelAll 
//http://85.215.176.20:5000/closeAll
//http://85.215.176.20:5000/buyStop   "qty":0.1, "price":16666.0  
//http://85.215.176.20:5000/sellStop  "qty":0.1, "price":16666.0  
//KILL ALL (SERVER and Trading )
// r.GET("/startEmaHedge", controller.StartEmaHedge)
// r.GET("/stopEmaHedge", controller.StopEmaHedge)
// r.GET("/startReverseEmaHedge", controller.StartReverseEmaHedge)
// r.GET("/stopReverseEmaHedge", controller.StopReverseEmaHedge)
// r.GET("/panic", controller.Panic)
// r.GET("/startManualHedge", controller.StartManualHedge)
// r.GET("/stopManualHedge", controller.StopManualHedge)

//DAX request 
// ws://85.215.176.20:8081/dax

//harshad6