<?php

include(__DIR__ . "/../config.inc.php");
include('../../ssi_smart/smart_form/include_form.php');

$defaul_value['lot'] = '1';

$array_strategy = array(
    'startEmaHedge' => 'Start Ema Hedge',
    'stopEmaHedge' => 'Stop Ema Hedge',
    'startReverseEmaHedge' => 'Start Reverse Ema Hedge',
    'stopReverseEmaHedge' => 'Stop Reverse Ema Hedge',
    'startManualHedge' => 'Start Manual Hedge',
    'stopManualHedge' => 'Stop Manual Hedge',
);

//baue ein select für Manaull oder Automatisch 
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_strategy', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_ema(data)", 'dataType' => "html");
$arr['field']['strategy_value'] = array('type' => 'dropdown', 'label' => 'Manual/Auto', 'array' => $array_strategy, 'class' => 'fluid search selection', 'validate' => true, 'value' => 'manual');
$arr['button']['submit'] = array('value' => 'Strategy', 'icon' => 'robot', 'class' => 'orange');
$output = call_form($arr);
$field_stratety =  $output['html'] . $output['js'];


//Start -  Trade
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_buy_sell', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['field'][] = array('type' => 'div', 'class' => 'two fields');
$arr['field']['buy_sell'] = array('type' => 'dropdown', 'label' => 'Trade', 'array' => array('buy' => 'Buy', 'sell' => 'Sell'), 'class' => 'fluid search selection', 'validate' => true, 'value' => 'buy');
$arr['field']['qty'] = array('type' => 'input', 'label' => 'Lots', 'focus' => true, 'value' => $defaul_value['lot'], 'validate' => true, 'wide' => 'three');

$arr['field'][] = array('type' => 'div_close');
$arr['button']['submit'] = array('value' => 'Market Order', 'icon' => 'play', 'class' => 'green circular fluid');
$output = call_form($arr);
$field_buysell_start =  $output['html'] . $output['js'];

//Stop - Trade
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_buy_sell_stop', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['field'][] = array('type' => 'div', 'class' => 'fields');
$arr['field']['buy_sell_stop'] = array('type' => 'dropdown', 'label' => 'Trade', 'array' => array('buyStop' => 'Stop Buy', 'sellStop' => 'Stop Sell'), 'class' => 'fluid search selection', 'validate' => true);
$arr['field']['qty'] = array('type' => 'input', 'label' => 'Lots', 'focus' => true, 'value' => $defaul_value['lot'], 'validate' => true, 'wide' => 'four');
$arr['field']['price'] = array('type' => 'input', 'label' => 'Price', 'focus' => true, 'validate' => true, 'wide' => 'six');
$arr['field'][] = array('type' => 'div_close');
$arr['button']['submit'] = array('value' => 'Stop Orders', 'icon' => 'counterclockwise rotated step backward', 'class' => 'circular blue');
$output = call_form($arr);
$field_buysell_stop = $output['html'] . $output['js'];

//Limit - Trade
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_buy_sell_limit', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['field'][] = array('type' => 'div', 'class' => 'fields');
$arr['field']['buy_sell_limit'] = array('type' => 'dropdown', 'label' => 'Trade', 'array' => array('buyLimit' => 'Limit Buy', 'sellLimit' => 'Limit Sell'), 'class' => 'fluid search selection', 'validate' => true);
$arr['field']['qty'] = array('type' => 'input', 'label' => 'Lots', 'focus' => true, 'value' => $defaul_value['lot'], 'validate' => true, 'wide' => 'four');
$arr['field']['price'] = array('type' => 'input', 'label' => 'Price', 'focus' => true, 'validate' => true, 'wide' => 'six');
$arr['field'][] = array('type' => 'div_close');
$arr['button']['submit'] = array('value' => 'Limit Orders', 'icon' => 'clockwise rotated step backward', 'class' => 'circular blue');
$output = call_form($arr);
$field_buysell_limit = $output['html'] . $output['js'];

//http://85.215.176.20:5000/buyLimit "qty":0.1, "price":16500.0, "takeProfitPrice":17000.0, "stopLossPrice":16000.0
//Take-Profit und Stop-Loss Parameter - Trade   


//Cancel all Orders or Close all Positions
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_cancel_close', 'class' => 'message');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['field']['cancel_close_all'] = array('type' => 'dropdown', 'label' => 'Order Management', 'array' => array('cancelAll' => 'Cancel Placed orders ', 'closeAll' => 'Cancel All orders'), 'class' => 'fluid search selection', 'validate' => true, 'value' => 'cancelAll');
$arr['button']['submit'] = array('value' => 'Order Managements', 'icon' => 'hand holding usd icon', 'class' => 'green');
$output = call_form($arr);
$field_cancel_close = $output['html'] . $output['js'] . "<br>";

//Hedging Strategy - Strategy ID Form
$arr['form'] = array('action' => "ajax/form_edit2.php", 'id' => 'form_choose_strategy', 'class' => 'message');
$arr['sql'] = array('query' => "SELECT * from ssi_trader.setting WHERE user_id = " . $_SESSION['user_id']);
$arr['ajax'] = array('success' => "submit_hedging(data)", 'dataType' => "html");
$arr['field']['broker_id'] = array('label' => 'Broker-Account', 'type' => 'dropdown', 'array_mysql' => 'SELECT broker_id, broker_server FROM ssi_trader.broker ORDER BY broker_server ASC', 'text' => 'title', 'class' => 'fluid search selection');
$arr['field']['strategy_id'] = array('label' => 'Hegding-Strategy', 'type' => 'dropdown', 'array_mysql' => 'SELECT group_id, title FROM ssi_trader.hedging_group ORDER BY title ASC', 'text' => 'title', 'class' => 'fluid search selection');
$arr['hidden']['list_id'] = 'form_setting1';
$arr['button']['submit'] = array('value' => "Choose ", 'color' => 'blue');
$output = call_form($arr);
$field_hedingstrategy_id =  $output['html'] . $output['js'] . "<br>";

//KILL ALL (SERVER and Trading )
$arr['form'] = array('action' => "ajax/post.php", 'id' => 'form_kill_all');
$arr['ajax'] = array('success' => "after_post_request(data)", 'dataType' => "html");
$arr['hidden']['kill_all'] = '1';
$arr['field']['button'] = array('type' => 'submit', 'value' => 'KILL ALL', 'icon' => 'skull crossbones', 'class' => 'red huge fluid');
$output = call_form($arr);
$field_killall = $output['html'] . $output['js'];

$field_info = "<div class='ui message'>Last Price <div class='ui input' ><input  id='price_trade' type='text'></div></div>";

//Wird über ajax alle 60 sek neu geladen
$smart_list = "<div id='stocksDataContainer'></div>";

?>
<style>
    .scrollable-segment {
        max-height: 600px;
        overflow-y: auto;
    }
</style>

<div style='max-width: 1100px; text-align:left;'>
    <div class="ui grid">
        <div class="eight wide column"><?= $field_stratety ?><br><?= $field_cancel_close ?><?= $field_killall ?><?= $field_info ?></div>
        <div class="eight wide column"><?= $field_buysell_start ?><br><?= $field_buysell_stop ?><br><?= $field_buysell_limit ?></div>
    </div>

    <div class="ui grid">
        <div class="five wide column"><?= $field_hedingstrategy_id ?><?= $field_hedingstrategy_account ?></div>
        <div class="eleven wide column">
            <div class='ui segment scrollable-segment'><?= $smart_list ?></div>
        </div>
    </div>
</div>
<script type='text/javascript' src='js/form_home.js'></script>



<?php
//http://85.215.176.20:5000/buyMarket "qty":0.1
//http://85.215.176.20:5000/sellMarket "qty":0.1


//cancel all for cancel pending orders
//http://85.215.176.20:5000/cancelAll 

//to close all open positions
//http://85.215.176.20:5000/closeAll

//STOP BUY and STOP SELL
//http://85.215.176.20:5000/buyStop   "qty":0.1, "price":16666.0  
//http://85.215.176.20:5000/sellStop  "qty":0.1, "price":16666.0  

//KILL ALL (SERVER and Trading )



    // r.GET("/startEmaHedge", controller.StartEmaHedge)
    // r.GET("/stopEmaHedge", controller.StopEmaHedge)
    // r.GET("/startReverseEmaHedge", controller.StartReverseEmaHedge)
    // r.GET("/stopReverseEmaHedge", controller.StopReverseEmaHedge)
    // r.GET("/panic", controller.Panic)



//DAX request 
// ws://85.215.176.20:8081/dax
//harshad6
